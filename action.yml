name: 'Licence checker'
description: 'Checks for open source licence.'
inputs:
  LC_URL:
    description: "URL used to download licence-checker binary"
    required: false
    default: "https://github.com/zepben/licence-checker/releases/latest/download/licence-checker"
  PATH:
    description: "Path to search for files to check."
    required: false
    default: "."
  PRIVATE:
    description: "Whether to check for private or public licences. True for private."
    required: false
    default: true
runs:
  using: "composite"
  steps: 
    - run: |
        mkdir -p /lc
        if ! [ -f /lc/licence-checker ]; then
          curl -o /lc/licence-checker -L $LC_URL
        fi
        chmod +x /lc/licence-checker

        priv=${{ inputs.private }}
        if [[ $priv == 'true' ]]; then type=private; else type=public; fi
        # -I {} specifies name of argument, and puts it first, as type must be last
        find $SEARCHPATH -regex "\(COPYING\|LICENSE\|.*\.\(py\|java\|kt\|cs\|proto\|js\|ts\)\)$" | xargs -n1 -I {} /lc/licence-checker {} $type
      shell: bash
      env:
        LC_URL: ${{ inputs.LC_URL }}
        SEARCHPATH: ${{ inputs.PATH  }}
        TYPE: ${{ inputs.TYPE }}
